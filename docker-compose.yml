#services:
#  uoai:
#    image: universal-offline-ai-chatbot:local
#    container_name: uoai_chatbot
#    ports:
#      - "8501:8501"
#    env_file:
#      - .env
#    volumes:
#      - ./data:/app/data
#      - ./vectorstore:/app/vectorstore
#      - ./src:/app/src
#      - ./streamlit_app.py:/app/streamlit_app.py
#      - ./main.py:/app/main.py
#    restart: unless-stopped
#    healthcheck:
#      test: ["CMD", "curl", "-f", "http://localhost:8501/ || exit 1"]
#      interval: 30s
#      timeout: 10s
#      retries: 3

#version with GPU fallback to CPU

version: "3.9"

services:
  uoai:
    image: universal-offline-ai-chatbot:local
    container_name: uoai_chatbot

    ports:
      - "8501:8501"

    env_file:
      - .env

    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility

    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

    volumes:
      - ./data:/app/data
      - ./vectorstore:/app/vectorstore
      - ./src:/app/src
      - ./streamlit_app.py:/app/streamlit_app.py
      - ./main.py:/app/main.py

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/"]
      interval: 30s
      timeout: 10s
      retries: 3
